<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>SKKU Flea Market</title>
	<link rel="icon" href="../img/favicon.png" type="image/png">
	<link rel="stylesheet" href="../vendors/bootstrap/bootstrap.min.css">
	<link rel="stylesheet" href="../vendors/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="../vendors/themify-icons/themify-icons.css">
	<link rel="stylesheet" href="../vendors/linericon/style.css">
	<link rel="stylesheet" href="../vendors/nice-select/nice-select.css">
	<link rel="stylesheet" href="../vendors/owl-carousel/owl.theme.default.min.css">
	<link rel="stylesheet" href="../vendors/owl-carousel/owl.carousel.min.css">
	<link rel="stylesheet" href="../css/style.css">
</head>

<body>
	<!--================ Start Header Menu Area =================-->
	<header class="header_area">
		<div class="main_menu">
			<nav class="navbar navbar-expand-lg navbar-light">
				<div class="container">
					<a class="navbar-brand logo_h" href="index.html"><img src="../img/logo.png" alt=""></a>
					<h6>Buy</h6>
					<button class="navbar-toggler" type="button" data-toggle="collapse"
						data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
						aria-expanded="false" aria-label="Toggle navigation">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<div class="collapse navbar-collapse offset" id="navbarSupportedContent">
						<ul class="nav navbar-nav menu_nav ml-auto mr-auto">
							<li class="nav-item"><a class="nav-link" href="index.html">About Us</a></li>
							<li class="nav-item"><a class="nav-link" href="list.html">Items List</a></li>
							<li class="nav-item"><a class="nav-link" href="contact.html">Contact Form</a></li>
						</ul>

						<ul class="nav-shop">
							<li class="nav-item"><button><i class="ti-shopping-cart"></i><span
										class="nav-shop__circle"></span></button> </li>
							<li class="nav-item"><a class="button button-header" href="../login.html">Sign Out</a></li>
						</ul>
					</div>
				</div>
			</nav>
		</div>
	</header>
	<!--================ End Header Menu Area =================-->

	<!-- ================ start banner area ================= -->
	<section class="blog-banner-area" id="blog">
		<div class="container h-100">
			<div class="blog-banner">
				<div class="text-center">
					<h1>Product Info</h1>
					<nav aria-label="breadcrumb" class="banner-breadcrumb">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="#">About Us</a></li>
							<li class="breadcrumb-item active" aria-current="page">Description</li>
						</ol>
					</nav>
				</div>
			</div>
		</div>
	</section>
	<!-- ================ end banner area ================= -->


	<!--================Single Product Area =================-->
	<div class="product_image_area">
		<div class="container">
			<div class="row s_product_inner">
				<div class="col-lg-6"></div>
				<div class="col-lg-5 offset-lg-1">
					<div class="s_product_text">
						<div class="product-info">
							<h3>Item: </h3>
							<h3 id="item_name"></h3>
						</div>
						<div class="product-info">
							<h4>Countdown: </h4>
							<h4 id="remain_time" style="color: red;"></h4>
						</div>
						<div class="product-info">
							<h4>Price: </h4>
							<h4 id="item_price"></h4>
						</div>
						<div class="product-info">
							<h4>Product Name: </h4>
							<h4 id="seller_name"></h4>
						</div>
						<div class="product-info">
							<h4>Contact: </h4>
							<h4 id="phone_number"></h4>
						</div>
						<div class="product-info">
							<h4>Place: </h4>
							<h4 id="trading_place"></h4>
						</div>
						<div>
							<input type="text" id="buyer-name" name="buyer-name" placeholder="your name"
								onfocus="this.placeholder = ''" onblur="this.placeholder = 'your name'">
						</div>
						<div>
							<input type="text" id="new-price" name="new-price" placeholder="new price"
								onfocus="this.placeholder = ''" onblur="this.placeholder = 'new price'">
							<button type="reset" onClick="clickBid()">Place Bid</button>
						</div>
					</div>

					<div class="product_count">
						<a class="button primary-btn" href="#">Add to Cart</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--================End Single Product Area =================-->

		<!-- Marks the start of the footer-->
	<footer>
		<div class="footer-bottom">
			<div class="container">
				<div class="row d-flex">
					<p class="col-lg-12 footer-text text-center">
						Copyright &copy;
						<script>document.write(new Date().getFullYear());</script>
						 SKKU - WEB LAB - Allan Tazhnenov
					</p>
				</div>
			</div>
		</div>
	</footer>
		<!-- End of the footer-->



	<script src="../vendors/jquery/jquery-3.2.1.min.js"></script>
	<script src="../vendors/bootstrap/bootstrap.bundle.min.js"></script>
	<script src="../vendors/skrollr.min.js"></script>
	<script src="../vendors/owl-carousel/owl.carousel.min.js"></script>
	<script src="../vendors/nice-select/jquery.nice-select.min.js"></script>
	<script src="../vendors/jquery.ajaxchimp.min.js"></script>
	<script src="../vendors/mail-script.js"></script>
	<script src="../js/main.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>


	<script>
	  var firebaseConfig = {
	    apiKey: "AIzaSyDMBmB3Qp6IIOnc2etk72sxSO9n1ocQGVE",
	    authDomain: "skku-project-web.firebaseapp.com",
	    projectId: "skku-project-web",
	    storageBucket: "skku-project-web.appspot.com",
	    messagingSenderId: "20634346129",
	    appId: "1:20634346129:web:1fbf6989218f1daa2c9530",
	    measurementId: "G-ZTE6TTHFR5"
	  };
	  firebase.initializeApp(firebaseConfig);
	  firebase.analytics();
	</script>

	<script>
		function getURLParameter(name) {
			return decodeURI(
				(RegExp(name + '=' + '(.+?)(&|$)').exec(location.search) || [, null])[1]
			);
		}
		function timeCounter(target_time) {
			var countDownDate = new Date(target_time).getTime();

			// Update the count down every 1 second
			var x = setInterval(function () {

				// Get today's date and time
				var now = new Date().getTime();

				// Find the distance between now and the count down date
				var distance = countDownDate - now;

				// Time calculations for days, hours, minutes and seconds
				var days = Math.floor(distance / (1000 * 60 * 60 * 24));
				var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
				var seconds = Math.floor((distance % (1000 * 60)) / 1000);

				// Display the result in the element with id="demo"
				document.getElementById("remain_time").innerHTML = days + "d " + hours + "h "
					+ minutes + "m " + seconds + "s ";

				// If the count down is finished, write some text
				if (distance < 0) {
					clearInterval(x);
					document.getElementById("remain_time").innerHTML = "Offer Unavailable";
				}
			}, 1000);
		}

		var item_id = getURLParameter("id");
		var db = firebase.firestore();
		var docList = [];

		db.collection("product").doc(item_id)
			.get()
			.then(function (doc) {
				if (doc.exists) {
					document.getElementById("item_name").textContent = doc.data().pname;
					document.getElementById("remain_time").textContent = timeCounter(doc.data().remaintime);
					document.getElementById("item_price").textContent = doc.data().price + " won";
					document.getElementById("seller_name").textContent = doc.data().seller;
					document.getElementById("phone_number").textContent = doc.data().phonenum;
					document.getElementById("trading_place").textContent = doc.data().tradingplace;
					$('.col-lg-6').css({
						"background": "url(" + doc.data().img_src + ")",
						"background-repeat": "no-repeat",
						"background-position": "center center",
						"background-size": "contain"
					});
				}
				else {
					alert("Error loading. Try again.");
				}
			})

		function clickBid() {
			var new_price = parseInt(document.getElementById("new-price").value);
			var buyer = document.getElementById("buyer-name").value;

			document.getElementById("new-price").value = "";
			document.getElementById("buyer-name").value = "";

			if (parseInt(document.getElementById("item_price").textContent) >= new_price) {
				alert("Price must be higher.");
				return;
			}
			document.getElementById("item_price").textContent = new_price;
			db.collection("product").doc(item_id)
				.update({
					price: new_price,
					history: firebase.firestore.FieldValue.arrayUnion({ buyer_name: buyer, price: new_price })
				});
			alert("Bid Placed!")
		}
	</script>

</body>

</html>
